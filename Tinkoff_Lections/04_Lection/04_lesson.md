# Лекторий по SRE: Детектирование проблем до и во время сбоя 

### Косвенные и прямые проблемы
Способы:
- прямые
- косвенные (резко меняются характеристики системы, 2хфакторная авторизация, если вместо 5% пользователей неуспешно авторизовалось 70%)

__Автотесты продакшена__ - быстрый и точный способ детектирования сбоев, редко дают ложный положительный результат. Относительно дороги в разработке. Полезность часто недооценивается (именно продакшена). Эффективность и полезность очень высока.

__Проберы__ - приложения выполняющие автотесты.

Рассказал про организацию сбора логов в Тинькоф. 5-10 минута. (много и быстро)

__Инструменты тестирования__:
- Prometheus blackbox exporter
- Selenium
- ЯП с библиотеками тестирования.

Самодиагностика - когда система имеет свою систему уведомлений о тех или иных событиях.

>Часто в ошибки записывают то, что не является ошибкой. Пример "Недостаток средств на счету" - это не ошибка. (пример Тинькофф)

<p align="center">
 <img width="600px" src="/Tinkoff_Lections/04_Lection/http.png">
</p>
<br>

>"С точки зрения мониторинга клиента полезно четко отделить внутренние ошибки от ошибок, пришедших от зависимостей"

Собственная система самодиагностики - это похоже на автотесты, но тестируют скрытые особенности систем.

Другие способы - косвенные (статистические). До этого обсуждались прямые.

Влияет: сезонность (будний день превратился в праздничный), внешние ресурсы (кто-то что написал про инвестиции -- все рванулись в тинькофф)

Жалобы пользователей.__downdetector__. Google все время мониторит твиттер на предмет упоминания гугла в том или ином ключе, свете. Т.е. пользователи информируют о косвенных сбоях. Канал достаточно шумный, но тем не менее канал пользователей полезный, но не основной.

>Настроенные пороги значений для детектирования сбоя, или ситуации близкой к сбою.

Машинное обучение. Вычисляется некий интервал потенциальной сезонной проблемы, и можно анализировать.

Выводы:

- Нужен комплексный подход
- диагностику сбоев надо проектировать
- в любом случае всегда сбои будут происходить


### Алертирование

>смотреть на мониторы очень не эффективно=)

__Алертирование__ - механизм привлечения внимания инженеров.

Его можно сделать очень неправильно.

Типичные ошибки:
- алерты обо всех ситуациях, что не является сбоем. Замусоренные, в перемешку с информационными.
- нарушение обратной связи. Алерты присылаются не тем людям.
- алертирование настраивают не те люди, которые реагируют на алерты(софт разрабатывает один человек, алерты другой, устраняет третий и они плохо взаимосвязаны)
- доставка алерта широкому кругу лиц. Порождает коллективную безотвественности или будет реагировать определенный круг лиц, самый опытный и ответственный. Это порождает басфактор.
- Также плохо когда алерт доставляется напрямую самому опытному. Приводит к тому, что опытные перегружены, формирует\
 __басфактор__ - _это мера сосредоточения информации среди отдельных членов проекта. Bus factor показывает количество разработчиков команды программистов, после потери которых проект не может быть дальше продолжен. Проект будет содержать такую информацию, с которой оставшиеся разработчики не смогут разобраться. Высокий bus factor проекта означает, что проект будет устойчиво развиваться, если его покинет даже большое количество программистов_.\
Получается, что опытные становятся еще более опытными, а неопытные так и остаются неопытными. Способ: равномерное распределение дежурства, когда мы знаем, кто из команды сейчас должен реагировать, этот человек знает. Дабы обеспечить ественным образом нарастание экспертизы, шеринг знаний по всем членам команды.

>Должен подтвердить получения alerta, если не может должен быть продуман процесс эскалации (двойные дежурства, информирование всей команды, руководству или иное)

>Алертируем только о сбоях или ситуациях требующих немедленного реагирования

>Тот кто получает алерт, должен реагировать на каждый алерт, но их не должно быть много, например 10. Если
