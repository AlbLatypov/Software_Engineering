# Install and Configure Ha Proxy LBR


### global

Этот раздел содержит глобальные настройки HAProxy, которые применяются ко всему процессу.

- __log /dev/log local0__ и __log /dev/log local1 notice__: Определяет, куда будут отправляться лог-сообщения. В данном случае они отправляются на локальный syslog с различными уровнями важности.
- __chroot /var/lib/haproxy__: Эта директива ограничивает видимость файловой системы для процесса HAProxy, что повышает безопасность.
- __stats socket /var/lib/haproxy/stats__: Определяет сокет для сбора статистики HAProxy.
- __stats timeout 30s__: Устанавливает тайм-аут для сокетов статистики.
- __user haproxy и group haproxy__: Определяет пользователя и группу, от имени которых будет работать процесс HAProxy.
- daemon: Запускает HAProxy в фоновом режиме (демон).


### defaults

Этот раздел содержит настройки по умолчанию, которые применяются ко всем frontend и backend, если они не переопределены локально.

- __log global__: Использует глобальные настройки логирования.
- __mode http__: Устанавливает режим работы на HTTP. Другие возможные режимы: tcp, health.
- __option httplog__: Включает подробное логирование HTTP-запросов.
- __option dontlognull__: Не логирует пустые запросы.
- __timeout connect 5000__: Тайм-аут на установление соединения (в миллисекундах).
- __timeout client 50000__: Тайм-аут для клиента (в миллисекундах).
- __timeout server 50000__: Тайм-аут для сервера (в миллисекундах).
- __errorfile 400__ /etc/haproxy/errors/400.http и другие errorfile: Определяет пользовательские страницы ошибок для различных HTTP-статусов.


### frontend

Этот раздел определяет входящие соединения и как они обрабатываются.

- __frontend http_front__: Имя frontend. Это имя может быть произвольным, но должно быть уникальным.
- __*bind :80__: Указывает, что HAProxy будет прослушивать все IP-адреса на порту 80.
- __default_backend http_back__: Указывает, какой backend использовать по умолчанию для входящих соединений.

### Раздел backend

Этот раздел определяет, как маршрутизировать трафик к реальным серверам.

- __backend http_back__: Имя backend. Это имя также может быть произвольным, но должно быть уникальным.
- __balance roundrobin__: Алгоритм балансировки нагрузки. В данном случае используется round-robin (по кругу).
- __server app1 192.168.1.101:80 check__: Определяет сервер app1 с IP-адресом 192.168.1.101 и портом 80. Параметр check активирует проверку состояния сервера.
- __server app2 192.168.1.102:80 check__: Аналогично, определяет сервер app2 с IP-адресом 192.168.1.102.
- __server app3 192.168.1.103:80 check__: Аналогично, определяет сервер app3 с IP-адресом 192.168.1.103.

### Дополнительные параметры и опции

- __option httpchk__: Используется для выполнения HTTP-запросов к серверам для проверки их состояния.
- __retries__: Определяет количество попыток переподключения к серверу перед пометкой его как недоступного.
- __maxconn__: Максимальное количество одновременных соединений, которые HAProxy разрешает.

Этот файл конфигурации представляет собой базовую настройку HAProxy, но он может быть значительно расширен для включения различных функций, таких как SSL-терминация, более сложные проверки состояния, различные алгоритмы балансировки нагрузки и многое другое.

### Еще одно описание.

### global

- __slowlog_flat 100__: Это параметр, который позволяет настроить журнал медленных запросов. В данном случае, HAproxy будет регистрировать запросы, которые выполняются дольше 100 миллисекунд.

defaults

- __mode http__: Определяет режим работы HAproxy. В данном случае, мы используем режим HTTP.
- __timeout connect 5000__: Определяет время ожидания подключения к серверу в миллисекундах. Если соединение не будет установлено в течение 5000 миллисекунд, HAproxy будет считать, что сервер недоступен.
- __timeout client 50000__: Определяет время ожидания ответа от клиента в миллисекундах. Если клиент не отправит запрос в течение 50000 миллисекунд, HAproxy будет считать, что клиент отключился.
- __timeout server 50000__: Определяет время ожидания ответа от сервера в миллисекундах. Если сервер не отправит ответ в течение 50000 миллисекунд, HAproxy будет считать, что сервер недоступен.

### frontend

- __bind *:80__: Определяет адрес и порт, на котором HAproxy будет слушать входящие запросы. В данном случае, HAproxy будет слушать на всех доступных интерфейсах (*) на порту 80.

### backend

- __mode http__: Определяет режим работы backend. В данном случае, мы используем режим HTTP.
- __balance roundrobin__: Определяет алгоритм балансировки нагрузки. В данном случае, мы используем алгоритм round-robin, который распределяет запросы между серверами в циклическом порядке.
- __server app_server1 192.168.1.100:80__ check: Определяет сервер приложения, к которому HAproxy будет направлять запросы. В данном случае, мы определили сервер с IP-адресом 192.168.1.100 и портом 80. Параметр check указывает, что HAproxy должен периодически проверять доступность сервера.


