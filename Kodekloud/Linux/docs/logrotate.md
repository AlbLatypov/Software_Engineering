# Ротация логов

logrotate — это утилита в Linux и Unix-подобных системах, которая автоматически rotates, compresses, removes и mails system logs. Это помогает системным администраторам управлять логами и обеспечивать, чтобы они не занимали слишком много дискового пространства.

Основное, что нужно знать о logrotate:

- Расположение конфигурационных файлов: Основной конфигурационный файл logrotate обычно находится в __/etc/logrotate.conf__. Дополнительные конфигурации можно найти в директории /etc/logrotate.d/.

- Частота запуска: logrotate обычно запускается ежедневно из cron-задачи.

- Параметры: logrotate имеет множество параметров, которые определяют, как обрабатываются логи. Некоторые из наиболее часто используемых параметров: rotate, daily, weekly, monthly, size, compress, missingok, notifempty, create.

- Обработка после rotation: Можно указать сценарии (postrotate), которые выполняются после rotation логов. Это часто используется для перезапуска сервисов, которые нуждаются в обновлении файлов логов.

Популярный пример файла конфигурации:

/var/log/myservice.log {
```bash
  daily
  rotate 7
  compress
  delaycompress
  missingok
  notifempty
  create 640 root adm
  postrotate
    /bin/kill -HUP `cat /var/run/myservice.pid`
  endscript
}
```
Разбор наиболее часто встречающихся параметров:

- daily: Выполняет rotation логов ежедневно.
- rotate 7: Сохраняет 7 rotated лог-файлов.
- compress: Сжимает rotated лог-файлы.
- delaycompress: Откладывает сжатие на следующий цикл rotation, чтобы последний rotated лог остался без сжатия.
- missingok: Не выдает ошибку, если лог-файл отсутствует.
- notifempty: Не выполняет rotation, если лог-файл пустой.
- create 640 root adm: Создает новый лог-файл после rotation с правами 640 и владельцем root и группой adm.
- postrotate/endscript: Сценарий внутри этих директив выполняется после rotation логов. В данном примере, он отправляет сигнал HUP процессу, указанному в /var/run/myservice.pid.

Этот пример демонстрирует типичную конфигурацию для сервиса, где логи ротируются ежедневно, сохраняется 7 последних ротированных логов, и после ротации отправляется сигнал процессу для обновления файла лога.

__Запуск logrotate__:

Вы можете запустить logrotate вручную с помощью следующей команды:

sudo logrotate /etc/logrotate.conf

Или для тестирования изменений без фактического выполнения rotation:

sudo logrotate -d /etc/logrotate.conf

logrotate — мощный инструмент для управления логами в Linux, который позволяет гибко настраивать политику rotation логов для различных сервисов и приложений.
